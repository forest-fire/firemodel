{"version":3,"file":"firemodel.umd.js","sources":["../src/decorators/decorator.ts","../src/decorators/property.ts","../src/FireModel.ts","../src/state-mgmt/index.ts","../src/Record.ts","../src/decorators/relationship.ts","../src/decorators/schema.ts","../src/Model.ts","../src/List.ts","../src/Mock.ts"],"sourcesContent":["import \"reflect-metadata\";\nimport { Model, IModelPropertyMeta, IModelRelationshipMeta } from \"..\";\nimport { IDictionary } from \"common-types\";\nimport { set, get } from \"lodash\";\n\nfunction push<T extends Model = Model>(\n  target: IDictionary,\n  path: string,\n  value: IModelPropertyMeta<T>\n) {\n  if (Array.isArray(get(target, path))) {\n    get(target, path).push(value);\n  } else {\n    set(target, path, [value]);\n  }\n}\n\n/** Properties accumlated by propertyDecorators  */\nconst propertiesByModel: IDictionary<IModelPropertyMeta[]> = {};\n/** Relationships accumlated by hasMany/ownedBy decorators */\nconst relationshipsByModel: IDictionary<IModelPropertyMeta[]> = {};\n\nexport const propertyDecorator = <T extends Model>(\n  nameValuePairs: IDictionary = {},\n  /**\n   * if you want to set the property being decorated's name\n   * as property on meta specify the meta properties name here\n   */\n  property?: string\n) => (target: Model, key: string): void => {\n  const reflect: IDictionary =\n    Reflect.getMetadata(\"design:type\", target, key) || {};\n  const meta: IModelPropertyMeta<T> = {\n    ...Reflect.getMetadata(key, target),\n    ...{ type: reflect.name },\n    ...nameValuePairs\n  };\n\n  Reflect.defineMetadata(key, meta, target);\n\n  if (nameValuePairs.isProperty) {\n    if (property) {\n      push(propertiesByModel, target.constructor.name, {\n        ...meta,\n        [property]: key\n      });\n    } else {\n      push(propertiesByModel, target.constructor.name, meta);\n    }\n  }\n  if (nameValuePairs.isRelationship) {\n    if (property) {\n      push(relationshipsByModel, target.constructor.name, {\n        ...meta,\n        [property]: key\n      });\n    } else {\n      push(relationshipsByModel, target.constructor.name, meta);\n    }\n  }\n};\n\n/** lookup meta data for schema properties */\nfunction propertyMeta<T extends Model = Model>(context: object) {\n  return (prop: string): IModelPropertyMeta<T> =>\n    Reflect.getMetadata(prop, context);\n}\n\n/**\n * Gets all the properties for a given model\n *\n * @param target the schema object which is being looked up\n */\nexport function getProperties(target: object) {\n  return [\n    ...propertiesByModel[target.constructor.name],\n    ...propertiesByModel.Model.map(s => ({\n      ...s,\n      ...{ isBaseSchema: true }\n    }))\n  ];\n}\n\n/**\n * Gets all the relationships for a given model\n */\nexport function getRelationships<T>(target: object) {\n  return relationshipsByModel[target.constructor.name] as Array<\n    IModelRelationshipMeta<T>\n  >;\n}\n\nexport function getPushKeys(target: object) {\n  const props = getProperties(target);\n  return props.filter(p => p.pushKey).map(p => p.property);\n}\n","import \"reflect-metadata\";\nimport { IDictionary, PropertyDecorator } from \"common-types\";\nimport { propertyDecorator } from \"./decorator\";\n\nexport function constrainedProperty(options: IDictionary = {}) {\n  return propertyDecorator(\n    {\n      ...options,\n      ...{ isRelationship: false, isProperty: true }\n    },\n    \"property\"\n  ) as PropertyDecorator;\n}\n\n/** allows the introduction of a new constraint to the metadata of a property */\nexport function constrain(prop: string, value: any) {\n  return propertyDecorator({ [prop]: value }) as PropertyDecorator;\n}\n\nexport function desc(value: string) {\n  return propertyDecorator({ desc: value }) as PropertyDecorator;\n}\n\nexport function min(value: number) {\n  return propertyDecorator({ min: value });\n}\n\nexport type MockFunction = (context: import(\"firemock\").MockHelper) => any;\n\nexport function mock(value: string | MockFunction) {\n  return propertyDecorator({ mockType: value });\n}\n\nexport function max(value: number) {\n  return propertyDecorator({ max: value });\n}\n\nexport function length(value: number) {\n  return propertyDecorator({ length: value });\n}\n\nexport const property = propertyDecorator(\n  {\n    isRelationship: false,\n    isProperty: true\n  },\n  \"property\"\n) as PropertyDecorator;\n\nexport const pushKey = propertyDecorator(\n  {\n    pushKey: true\n  },\n  \"property\"\n) as PropertyDecorator;\n","import { Model } from \"./Model\";\n// tslint:disable-next-line:no-implicit-dependencies\nimport { RealTimeDB } from \"abstracted-firebase\";\nimport { IModelMetaProperties } from \"./index\";\nimport { Record } from \"./Record\";\nimport { IDictionary } from \"common-types\";\nimport {\n  IFMRecordEvent,\n  FMEvents,\n  NotString,\n  Extractable,\n  IFMRelationshipEvent,\n  IFMEventName\n} from \"./state-mgmt\";\nimport { IReduxDispatch } from \"./VuexWrapper\";\n// tslint:disable-next-line:no-var-requires\nconst pluralize = require(\"pluralize\");\nconst defaultDispatch = (context: IDictionary) => \"\";\n\nexport class FireModel<T extends Model> {\n  //#region STATIC INTERFACE\n\n  public static isBeingWatched(path: string): boolean {\n    // TODO: implement this!\n    return false;\n  }\n  private static _defaultDb: import(\"abstracted-firebase\").RealTimeDB = null;\n  private static _dispatchActive: boolean = false;\n  /** the dispatch function used to interact with frontend frameworks */\n  private static _dispatch: IReduxDispatch = defaultDispatch;\n\n  public static get defaultDb() {\n    return FireModel._defaultDb;\n  }\n\n  public static set defaultDb(db: import(\"abstracted-firebase\").RealTimeDB) {\n    this._defaultDb = db;\n  }\n\n  public static set dispatch(fn: IReduxDispatch) {\n    if (!fn) {\n      FireModel._dispatchActive = false;\n      FireModel._dispatch = defaultDispatch;\n    } else {\n      FireModel._dispatchActive = true;\n      FireModel._dispatch = fn;\n    }\n  }\n\n  public static get dispatch() {\n    return FireModel._dispatch;\n  }\n\n  //#endregion\n\n  //#region OBJECT INTERFACE\n\n  /** the data structure/model that this class operates around */\n  protected _model: T;\n  protected _modelConstructor: new () => T;\n  protected _db: RealTimeDB;\n\n  //#endregion\n\n  //#region PUBLIC INTERFACE\n\n  public get modelName() {\n    return this._model.constructor.name.toLowerCase();\n  }\n\n  public get pluralName() {\n    // TODO: add back the exception processing\n    return pluralize(this.modelName);\n  }\n\n  public get dbPath() {\n    return \"dbPath was not overwritten!\";\n  }\n\n  public get localPath() {\n    return \"dbPath was not overwritten!\";\n  }\n\n  public get META(): IModelMetaProperties<T> {\n    return (this._model as Model).META;\n  }\n\n  public get properties() {\n    return (this._model as Model).META.properties;\n  }\n\n  public get relationships() {\n    return (this._model as Model).META.relationships;\n  }\n\n  public get dispatch() {\n    return FireModel.dispatch;\n  }\n\n  public get dispatchIsActive(): boolean {\n    return FireModel._dispatchActive;\n  }\n\n  /** the connected real-time database */\n  public get db() {\n    if (!this._db) {\n      this._db = FireModel.defaultDb;\n    }\n    if (!this._db) {\n      const e = new Error(\n        `Can't get DB as it has not been set yet for this instance and no default database exists [ ${\n          this.modelName\n        } ]!`\n      );\n      e.name = \"FireModel::NoDatabase\";\n      throw e;\n    }\n\n    return this._db;\n  }\n\n  public get pushKeys() {\n    return (this._model as Model).META.pushKeys;\n  }\n\n  //#endregion\n\n  //#region PROTECTED INTERFACE\n\n  /**\n   * Creates a Redux-styled event\n   */\n  protected _createRecordEvent<\n    K extends string & NotString<K> & Extractable<FMEvents, K>\n  >(record: Record<T>, type: K, pathsOrValue: IMultiPathUpdates[] | T) {\n    const payload: Partial<IFMRecordEvent<T>> = {\n      type,\n      model: record.modelName,\n      modelConstructor: record._modelConstructor,\n      dbPath: record.dbPath,\n      localPath: record.localPath,\n      key: record.id\n    };\n    if (Array.isArray(pathsOrValue)) {\n      payload.paths = pathsOrValue;\n    } else {\n      payload.value = pathsOrValue;\n    }\n\n    return payload as IFMRecordEvent<T>;\n  }\n\n  protected _createRelationshipEvent<K extends IFMEventName<K>>(\n    record: Record<T>,\n    type: K,\n    relProp: keyof T,\n    fk: string,\n    paths?: any[]\n  ) {\n    const fkConstruct = record.META.property(relProp).fkConstructor;\n    const hasInverse = record.META.property(relProp).inverse;\n    const fkRecord = Record.create(fkConstruct);\n    const payload: any = {\n      type,\n      model: record.modelName,\n      modelConstructor: record._modelConstructor,\n      dbPath: record.dbPath,\n      localPath: record.localPath,\n      key: record.id,\n      paths,\n      fk,\n      fkModelName: fkRecord.modelName,\n      fkHasInverse: hasInverse\n    };\n\n    return payload;\n  }\n\n  protected _getPaths(changes: IDictionary): IMultiPathUpdates[] {\n    return Object.keys(changes).reduce(\n      (prev: any[], current: Extract<keyof typeof changes, string>) => {\n        const path = current;\n        const value = changes[current];\n        return [].concat(prev, [{ path, value }]);\n      },\n      []\n    );\n  }\n\n  //#endregion\n}\n\nexport interface IMultiPathUpdates {\n  path: string;\n  value: any;\n}\n","import { SerializedQuery } from \"serialized-query\";\nimport { Model, FMModelConstructor } from \"../Model\";\nimport { ISchemaRelationshipType } from \"../decorators/schema\";\nimport { IMultiPathUpdates } from \"../FireModel\";\n//#region generalized structures\n\nexport type Extractable<T, U> = T extends U ? any : never;\nexport type NotString<T> = string extends T ? never : any;\nfunction promoteStringToFMEvents<\n  K extends string & NotString<K> & Extractable<FMEvents, K>\n>(k: K): Extract<FMEvents, K> {\n  return k;\n}\n\nexport type IFMEventName<T> = string & NotString<T> & Extractable<FMEvents, T>;\n\n/** Enumeration of all Firemodel Actions that will be fired */\nexport enum FMEvents {\n  /** A record has been added locally */\n  RECORD_ADDED_LOCALLY = \"@firemodel/RECORD_ADDED_LOCALLY\",\n  /** A record has been added to a given Model list being watched */\n  RECORD_ADDED = \"@firemodel/RECORD_ADDED\",\n  /** A record has been updated locally */\n  RECORD_CHANGED_LOCALLY = \"@firemodel/RECORD_CHANGED_LOCALLY\",\n  /** A record has been updated on Firebase */\n  RECORD_CHANGED = \"@firemodel/RECORD_CHANGED\",\n  /** for client originated events touching relationships (as external events would come back as an event per model) */\n  RECORD_MOVED = \"@firemodel/RECORD_MOVED\",\n  /** A record has been removed from a given Model list being watched */\n  RECORD_REMOVED_LOCALLY = \"@firemodel/RECORD_REMOVED_LOCALLY\",\n  /** A record has been removed from a given Model list being watched */\n  RECORD_REMOVED = \"@firemodel/RECORD_REMOVED\",\n\n  /** Watcher has established connection with Firebase */\n  WATCHER_STARTED = \"@firemodel/WATCHER_STARTED\",\n  /** Watcher has disconnected an event stream from Firebase */\n  WATCHER_STOPPED = \"@firemodel/WATCHER_STOPPED\",\n  /** Watcher has disconnected all event streams from Firebase */\n  WATCHER_STOPPED_ALL = \"@firemodel/WATCHER_STOPPED_ALL\",\n  /** A Record has removed a relationship from another */\n  RELATIONSHIP_REMOVED = \"@firemodel/RELATIONSHIP_REMOVED\",\n  RELATIONSHIP_ADDED = \"@firemodel/RELATIONSHIP_ADDED\",\n\n  APP_CONNECTED = \"@firemodel/APP_CONNECTED\",\n  APP_DISCONNECTED = \"@firemodel/APP_DISCONNECTED\"\n}\n\nexport interface IFMChangedPath {\n  /** a dot delimited property path to the location for local state */\n  localPath: string;\n  /** a dot delimited property path to the location in the database */\n  dbPath: string;\n  /** the value to set at this path */\n  value: any;\n}\n\nexport interface IFMRelationshipEvent<T extends Model = Model>\n  extends IFMRecordEventCore<T> {\n  fk: string;\n  fkModelName: string;\n  fkHasInverse: boolean;\n  fkConstructor?: FMModelConstructor<T>;\n  fkRelType?: ISchemaRelationshipType;\n  fkLocalPath?: string;\n}\n\nexport interface IFMRecordEventCore<T extends Model = Model> {\n  /** the unique identifier of the event type/kind */\n  type: string;\n  /** the name of the Model who's record has changed */\n  model: string;\n  /** the constructor for the Model of the record which has changed */\n  modelConstructor: FMModelConstructor<T>;\n  /** the path in Firebase where this Record should is stored */\n  dbPath: string;\n  /** the path in your local state management where this Record should go */\n  localPath: string;\n  /** an identifier of which active watcher which triggered to create this event, not populated in the case of a client triggered event */\n  watcherHash?: string;\n  /** the Record's \"id\" property */\n  key: string;\n  /** the key/ID the previous state; provided only on child_moved and child_changed */\n  prevKey?: string;\n}\n\nexport interface IFMRecordClientEvent<T extends Model = Model>\n  extends IFMRecordEventCore<T> {\n  /** paths that will be updated; this is only provided on client originated events */\n  paths?: IMultiPathUpdates[];\n}\n\nexport interface IFMRecordExternalEvent<T extends Model = Model>\n  extends IFMRecordEventCore<T> {\n  /** the value of the Record after the change */\n  value: T;\n}\n\nexport type IFMRecordEvent<T = Model> = IFMRecordClientEvent<T> &\n  IFMRecordExternalEvent<T>;\n\nexport interface IFMAction {\n  type: string;\n  payload: any;\n}\n\nexport interface IFMChildAction extends IFMAction {\n  key: string;\n  path: string;\n  model: string;\n  query: SerializedQuery | null;\n}\n\nexport interface IFMValueAction extends IFMAction {\n  model: string;\n  query: SerializedQuery | null;\n}\n//#endregion\n\n//#region specific events\n\n//#endregion\n","// tslint:disable-next-line:no-implicit-dependencies\nimport { RealTimeDB } from \"abstracted-firebase\";\nimport { Model } from \"./Model\";\nimport { createError, fk, IDictionary, pathJoin } from \"common-types\";\nimport { key as fbKey } from \"firebase-key\";\nimport { FireModel, IMultiPathUpdates } from \"./FireModel\";\nimport { IReduxDispatch } from \"./VuexWrapper\";\nimport { FMEvents, IFMEventName } from \"./state-mgmt/index\";\n\nexport interface IWriteOperation {\n  id: string;\n  type: \"set\" | \"pushKey\" | \"update\";\n  /** The database path being written to */\n  path: string;\n  /** The new value being written to database */\n  value: any;\n  /** called on positive confirmation received from server */\n  callback: (type: string, value: any) => void;\n}\n\nexport interface IRecordOptions {\n  db?: RealTimeDB;\n  logging?: any;\n  id?: string;\n  /** if you're working off of a mocking database, there are situations where adding a record silently (aka., not triggering any listener events) is desirable and should be allowed */\n  silent?: boolean;\n}\n\nexport class Record<T extends Model> extends FireModel<T> {\n  //#region STATIC INTERFACE\n  public static set defaultDb(db: RealTimeDB) {\n    FireModel.defaultDb = db;\n  }\n  public static get defaultDb() {\n    return FireModel.defaultDb;\n  }\n\n  public static set dispatch(fn: IReduxDispatch) {\n    FireModel.dispatch = fn;\n  }\n  /**\n   * create\n   *\n   * creates a new -- and empty -- Record object; often used in\n   * conjunction with the Record's initialize() method\n   */\n  public static create<T extends Model>(\n    model: new () => T,\n    options: IRecordOptions = {}\n  ) {\n    const r = new Record<T>(model, options);\n    if (options.silent && !r.db.isMockDb) {\n      const e = new Error(\n        `You can only add new records to the DB silently when using a Mock database!`\n      );\n      e.name = \"FireModel::Forbidden\";\n      throw e;\n    }\n\n    return r;\n  }\n\n  /**\n   * add\n   *\n   * Adds a new record to the database\n   *\n   * @param schema the schema of the record\n   * @param payload the data for the new record\n   * @param options\n   */\n  public static async add<T extends Model>(\n    model: new () => T,\n    payload: T,\n    options: IRecordOptions = {}\n  ) {\n    let r;\n    try {\n      r = Record.create(model, options);\n      r._initialize(payload);\n      await r._save();\n    } catch (e) {\n      const err = new Error(`Problem adding new Record: ${e.message}`);\n      err.name = e.name !== \"Error\" ? e.name : \"FireModel\";\n      throw e;\n    }\n\n    return r;\n  }\n\n  /**\n   * load\n   *\n   * static method to create a Record when you want to load the\n   * state of the record with something you already have.\n   *\n   * Intent should be that this record already exists in the\n   * database. If you want to add to the database then use add()\n   */\n  public static createWith<T extends Model>(\n    model: new () => T,\n    payload: T,\n    options: IRecordOptions = {}\n  ) {\n    const rec = Record.create(model, options);\n    rec._initialize(payload);\n\n    return rec;\n  }\n\n  public static async get<T extends Model>(\n    model: new () => T,\n    id: string,\n    options: IRecordOptions = {}\n  ) {\n    const record = Record.create(model, options);\n    await record._getFromDB(id);\n    return record;\n  }\n\n  public static async remove<T extends Model>(\n    model: new () => T,\n    id: string,\n    /** if there is a known current state of this model you can avoid a DB call to get it */\n    currentState?: Record<T>\n  ) {\n    // TODO: add lookup in local state to see if we can avoid DB call\n    const record = currentState ? currentState : await Record.get(model, id);\n    await record.remove();\n    return record;\n  }\n\n  //#endregion\n\n  //#region OBJECT DEFINITION\n  private _existsOnDB: boolean = false;\n  private _writeOperations: IWriteOperation[] = [];\n  private _data?: Partial<T>;\n\n  constructor(model: new () => T, options: IRecordOptions = {}) {\n    super();\n    if (!model) {\n      const e = new Error(\n        `You can not construct a Record instance without passing in a Model's constructor! `\n      );\n      e.name = \"FireModel::Forbidden\";\n      throw e;\n    }\n    this._modelConstructor = model;\n    this._model = new model();\n    this._data = new model();\n  }\n\n  public get data() {\n    return this._data as Readonly<T>;\n  }\n\n  public get isDirty() {\n    return this.META.isDirty ? true : false;\n  }\n\n  /**\n   * set the dirty flag of the model\n   */\n  public set isDirty(value: boolean) {\n    this._data.META = { isDirty: value };\n  }\n\n  /**\n   * returns the fully qualified name in the database to this record;\n   * this of course includes the record id so if that's not set yet calling\n   * this getter will result in an error\n   */\n  public get dbPath() {\n    if (!this.data.id) {\n      throw createError(\n        \"record/invalid-path\",\n        `Invalid Record Path: you can not ask for the dbPath before setting an \"id\" property.`\n      );\n    }\n    return [this.data.META.dbOffset, this.pluralName, this.data.id].join(\"/\");\n  }\n\n  /** The Record's primary key */\n  public get id() {\n    return this.data.id;\n  }\n\n  public set id(val: string) {\n    if (this.data.id) {\n      const e = new Error(\n        `You may not re-set the ID of a record [ ${this.data.id} → ${val} ].`\n      );\n      e.name = \"NotAllowed\";\n      throw e;\n    }\n\n    this._data.id = val;\n  }\n\n  /**\n   * returns the record's database offset without including the ID of the record;\n   * among other things this can be useful prior to establishing an ID for a record\n   */\n  public get dbOffset() {\n    return this.data.META.dbOffset;\n  }\n\n  /**\n   * returns the record's location in the frontend state management framework;\n   * depends on appropriate configuration of model to be accurate.\n   */\n  public get localPath() {\n    if (!this.data.id) {\n      throw new Error(\n        'Invalid Path: you can not ask for the dbPath before setting an \"id\" property.'\n      );\n    }\n    return [this.data.META.localOffset, this.pluralName, this.data.id].join(\n      \"/\"\n    );\n  }\n\n  /**\n   * Allows an empty Record to be initialized to a known state.\n   * This is not intended to allow for mass property manipulation other\n   * than at time of initialization\n   *\n   * @param data the initial state you want to start with\n   */\n  public _initialize(data: T) {\n    Object.keys(data).map(key => {\n      this._data[key as keyof T] = data[key as keyof T];\n    });\n    const relationships = this.META.relationships;\n\n    const ownedByRels = (relationships || [])\n      .filter(r => r.relType === \"ownedBy\")\n      .map(r => r.property);\n    const hasManyRels = (relationships || [])\n      .filter(r => r.relType === \"hasMany\")\n      .map(r => r.property);\n\n    // default hasMany to empty hash\n    hasManyRels.map((p: string) => {\n      if (!this._data[p as keyof T]) {\n        (this._data as any)[p] = {};\n      }\n    });\n\n    const now = new Date().getTime();\n    if (!this._data.lastUpdated) {\n      this._data.lastUpdated = now;\n    }\n    if (!this._data.createdAt) {\n      this._data.createdAt = now;\n    }\n  }\n\n  public get existsOnDB() {\n    return this.data && this.data.id ? true : false;\n  }\n\n  /**\n   * Pushes new values onto properties on the record\n   * which have been stated to be a \"pushKey\"\n   */\n  public async pushKey<K extends keyof T>(\n    property: K,\n    value: T[K][keyof T[K]]\n  ) {\n    if (this.META.pushKeys.indexOf(property as any) === -1) {\n      throw createError(\n        \"invalid-operation/not-pushkey\",\n        `Invalid Operation: you can not push to property \"${property}\" as it has not been declared a pushKey property in the schema`\n      );\n    }\n\n    if (!this.existsOnDB) {\n      throw createError(\n        \"invalid-operation/not-on-db\",\n        `Invalid Operation: you can not push to property \"${property}\" before saving the record to the database`\n      );\n    }\n    const key = fbKey();\n    const currentState = this.get(property) || {};\n    const newState = { ...(currentState as any), [key]: value };\n    // set state locally\n    this.set(property, newState);\n    // push updates to db\n    const write = this.db.multiPathSet(`${this.dbPath}/`);\n    write.add({ path: `lastUpdated`, value: new Date().getTime() });\n    write.add({ path: `${property}/${key}`, value });\n    try {\n      await write.execute();\n    } catch (e) {\n      throw createError(\"multi-path/write-error\", \"\", e);\n    }\n\n    return key;\n  }\n\n  /**\n   * Updates a set of properties on a given model atomically (aka, all at once); will automatically\n   * include the \"lastUpdated\" property. Does NOT allow relationships to be included,\n   * this should be done separately.\n   *\n   * @param props a hash of name value pairs which represent the props being updated and their new values\n   */\n  public async update(props: Partial<T>) {\n    // can not update relationship properties\n    if (\n      Object.keys(props).some((key: any) => {\n        const root = key.split(\".\")[0];\n        return this.META.property(root).isRelationship;\n      })\n    ) {\n      const relProps = Object.keys(props).filter(\n        (p: any) => this.META.property(p).isRelationship\n      );\n      const e = new Error(\n        `You called update on a hash which has relationships included in it. Please only use \"update\" for updating properties. The relationships you were attempting to update were: ${relProps.join(\n          \", \"\n        )}.`\n      );\n      e.name = \"FireModel::NotAllowed\";\n      throw e;\n    }\n\n    const lastUpdated = new Date().getTime();\n    const changed: any = {\n      ...(props as IDictionary),\n      lastUpdated\n    };\n    await this._updateProps(\n      FMEvents.RECORD_CHANGED_LOCALLY,\n      FMEvents.RECORD_CHANGED,\n      changed\n    );\n    if (this.META.audit) {\n      // TODO: implement for auditing\n    }\n\n    return;\n  }\n\n  /**\n   * remove\n   *\n   * Removes the active record from the database and dispatches the change to\n   * FE State Mgmt.\n   */\n  public async remove() {\n    this.isDirty = true;\n    this.dispatch(\n      this._createRecordEvent(this, FMEvents.RECORD_REMOVED_LOCALLY, [\n        { path: this.dbPath, value: null }\n      ])\n    );\n    await this.db.remove(this.dbPath);\n    if (this.META.audit) {\n      // TODO: implement for auditing\n    }\n    this.isDirty = false;\n    this.dispatch(\n      this._createRecordEvent(this, FMEvents.RECORD_REMOVED, this.data)\n    );\n  }\n\n  /**\n   * Changes the local state of a property on the record\n   *\n   * @param prop the property on the record to be changed\n   * @param value the new value to set to\n   */\n  public async set<K extends keyof T>(prop: K, value: T[K]) {\n    if (this.META.property(prop).isRelationship) {\n      const e = new Error(\n        `You can not \"set\" the property \"${prop}\" because it is configured as a relationship!`\n      );\n      e.name = \"FireModel::NotAllowed\";\n      throw e;\n    }\n    const lastUpdated = new Date().getTime();\n    const changed: any = {\n      [prop]: value,\n      lastUpdated\n    };\n    await this._updateProps(\n      FMEvents.RECORD_CHANGED_LOCALLY,\n      FMEvents.RECORD_CHANGED,\n      changed\n    );\n    if (this.META.audit) {\n      // TODO: implement for auditing\n    }\n\n    return;\n  }\n\n  /**\n   * Adds one or more fk's to a hasMany relationship\n   *\n   * @param property the property which is acting as a foreign key (array)\n   * @param refs FK reference (or array of FKs) that should be added to reln\n   * @param optionalValue the default behaviour is to add the value TRUE but you can optionally add some additional piece of information here instead.\n   */\n  public async addToRelationship(\n    property: Extract<keyof T, string>,\n    refs: Extract<fk, string> | Array<Extract<fk, string>>,\n    optionalValue: any = true\n  ) {\n    console.log(\"property: \", property);\n\n    if (this.META.property(property).relType !== \"hasMany\") {\n      const e = new Error(\n        `FireModel::addToRelationship() - can not use property \"${property}\" on ${\n          this.modelName\n        } with addToRelationship() because it is not a hasMany relationship [ relType: ${\n          this.META.property(property).relType\n        }, inverse: ${this.META.property(property).inverse} ]`\n      );\n      e.name = \"FireModel::WrongRelationshipType\";\n      throw e;\n    }\n\n    if (!Array.isArray(refs)) {\n      refs = [refs];\n    }\n    const now = new Date().getTime();\n    const mps = this.db.multiPathSet(\"/\");\n    const inverseProperty = this.META.property(property).inverseProperty;\n    const fkRecord = Record.create(this.META.property(property).fkConstructor);\n\n    refs.map(ref => {\n      const pathToThisFkReln = pathJoin(this.dbPath, property, ref);\n\n      mps.add({ path: pathToThisFkReln, value: optionalValue });\n      // INVERSE RELATIONSHIP\n      if (inverseProperty) {\n        console.log(\n          `The inverse FK is ${inverseProperty} on ${fkRecord.modelName}`\n        );\n        console.log(\n          `The inverse FK META is: `,\n          fkRecord.META.relationship(inverseProperty)\n        );\n        const pathToInverseFkReln = inverseProperty\n          ? pathJoin(fkRecord.dbOffset, ref, inverseProperty)\n          : null;\n        const fkInverseIsHasManyReln = inverseProperty\n          ? fkRecord.META.relationship(inverseProperty).relType === \"hasMany\"\n          : false;\n        mps.add({\n          path: fkInverseIsHasManyReln\n            ? pathJoin(pathToThisFkReln, this.id)\n            : pathToThisFkReln,\n          value: fkInverseIsHasManyReln ? true : this.id\n        });\n      }\n      if (\n        typeof this.data[property] === \"object\" &&\n        (this.data[property] as any)[ref]\n      ) {\n        console.warn(\n          `The fk of \"${ref}\" already exists in \"${\n            this.modelName\n          }.${property}\"!`\n        );\n        return;\n      }\n    });\n    mps.add({ path: pathJoin(this.dbPath, \"lastUpdated\"), value: now });\n\n    this.dispatch(\n      this._createRecordEvent(this, FMEvents.RECORD_ADDED_LOCALLY, mps.payload)\n    );\n    await mps.execute();\n    this.dispatch(\n      this._createRecordEvent(this, FMEvents.RECORD_ADDED, this.data)\n    );\n  }\n\n  /** indicates whether this record is already being watched locally */\n  public get isBeingWatched() {\n    return FireModel.isBeingWatched(this.dbPath);\n  }\n\n  /**\n   * get a property value from the record\n   *\n   * @param prop the property being retrieved\n   */\n  public get<K extends keyof T>(prop: K) {\n    return this.data[prop];\n  }\n\n  public toString() {\n    return `Record::${this.modelName}@${this.id || \"undefined\"}`;\n  }\n\n  public toJSON() {\n    return {\n      dbPath: this.dbPath,\n      modelName: this.modelName,\n      pluralName: this.pluralName,\n      key: this.id,\n      localPath: this.localPath,\n      data: this.data.toString()\n    };\n  }\n\n  protected async _updateProps<K extends IFMEventName<K>>(\n    actionTypeStart: K,\n    actionTypeEnd: K,\n    changed: Partial<T>\n  ) {\n    this.isDirty = true;\n    Object.keys(changed).map((prop: Extract<string, keyof T>) => {\n      this._data[prop] = changed[prop];\n    });\n    const paths = this._getPaths(changed);\n\n    this.dispatch(this._createRecordEvent(this, actionTypeStart, paths));\n\n    const mps = this.db.multiPathSet(this.dbPath);\n    paths.map(path => mps.add(path));\n    await mps.execute();\n    this.isDirty = false;\n    this._data.lastUpdated = new Date().getTime();\n\n    // if this path is being watched we should avoid\n    // sending a duplicative event\n    if (!this.isBeingWatched) {\n      this.dispatch(this._createRecordEvent(this, actionTypeEnd, this.data));\n    }\n  }\n\n  /**\n   * Load data from a record in database\n   */\n  private async _getFromDB(id: string) {\n    if (!this.db) {\n      const e = new Error(\n        `The attempt to load data into a Record requires that the DB property be initialized first!`\n      );\n      e.name = \"NoDatabase\";\n      throw e;\n    }\n\n    this._data.id = id;\n    const data = await this.db.getRecord<T>(this.dbPath);\n\n    if (data && data.id) {\n      this._initialize(data);\n    } else {\n      throw new Error(\n        `Unknown Key: the key \"${id}\" was not found in Firebase at \"${\n          this.dbPath\n        }\".`\n      );\n    }\n\n    return this;\n  }\n\n  private async _save() {\n    if (!this.id) {\n      this.id = fbKey();\n    }\n    const now = new Date().getTime();\n    if (!this.get(\"createdAt\")) {\n      this._data.createdAt = now;\n    }\n    this._data.lastUpdated = now;\n    if (!this.db) {\n      const e = new Error(\n        `Attempt to save Record failed as the Database has not been connected yet. Try settingFireModel first.`\n      );\n      e.name = \"FiremodelError\";\n      throw e;\n    }\n    const paths: IMultiPathUpdates[] = [{ path: \"/\", value: this._data }];\n    this.isDirty = true;\n    this.dispatch(\n      this._createRecordEvent(this, FMEvents.RECORD_ADDED_LOCALLY, paths)\n    );\n    const mps = this.db.multiPathSet(this.dbPath);\n    paths.map(path => mps.add(path));\n    await mps.execute();\n    this.isDirty = false;\n\n    if (!FireModel.isBeingWatched(this.dbPath)) {\n      // TODO: is there any reason we'd need to load from server like with update?\n      this.dispatch(\n        this._createRecordEvent(this, FMEvents.RECORD_ADDED, this.data)\n      );\n    }\n\n    return this;\n  }\n\n  //#endregion\n}\n","import \"reflect-metadata\";\nimport { propertyDecorator } from \"./decorator\";\nimport { Record } from \"../Record\";\n\nexport function hasMany(modelConstructor: new () => any) {\n  const rec = Record.create(modelConstructor);\n  const payload = {\n    isRelationship: true,\n    isProperty: false,\n    relType: \"hasMany\",\n    fkConstructor: modelConstructor,\n    fkModelName: rec ? rec.modelName : null\n  };\n\n  console.log(\n    `registering hasMany:`,\n    payload,\n    rec.META ? rec.META : \"self-reference: \"\n  );\n\n  return propertyDecorator(payload, \"property\") as PropertyDecorator;\n}\n\nexport function ownedBy(modelConstructor: new () => any) {\n  const rec = Record.create(modelConstructor);\n  const payload = {\n    isRelationship: true,\n    isProperty: false,\n    relType: \"ownedBy\",\n    fkConstructor: modelConstructor,\n    fkModelName: rec.modelName\n  };\n\n  console.log(`registering ownedBy: `, payload, rec.META);\n\n  return propertyDecorator(payload, \"property\") as PropertyDecorator;\n}\n\nexport function inverse(inverseProperty: string) {\n  return propertyDecorator({ inverseProperty });\n}\n","import \"reflect-metadata\";\nimport { IDictionary, ClassDecorator } from \"common-types\";\nimport { getRelationships, getProperties, getPushKeys } from \"./decorator\";\nimport { Model } from \"../Model\";\n/* tslint:disable:only-arrow-functions */\n\nexport type ISchemaRelationshipType = \"hasMany\" | \"ownedBy\";\n\nexport interface IModelMetaProperties<T extends Model = any> {\n  /** Optionally specify a root path to store this schema under */\n  dbOffset?: string;\n  /** Optionally specify a root path where the local store will put this schema */\n  localOffset?: string;\n  /** a function to lookup the meta properties of a given property */\n  property?: (prop: keyof T) => IModelPropertyMeta<T>;\n  /** a function to lookup the meta properties of a given relationship */\n  relationship?: (prop: keyof T) => IModelRelationshipMeta<T>;\n  audit?: boolean;\n  /** A list of all properties and associated meta-data for the given schema */\n  properties?: Array<IModelPropertyMeta<T>>;\n  /** A list of all relationships and associated meta-data for the given schema */\n  relationships?: Array<IModelRelationshipMeta<T>>;\n  /** A list of properties which should be pushed using firebase push() */\n  pushKeys?: string[];\n  /** indicates whether this property has been changed on client but not yet accepted by server */\n  isDirty?: boolean;\n}\n\nexport interface IModelRelationshipMeta<T extends Model = Model>\n  extends IModelPropertyMeta<T> {\n  isRelationship: true;\n  isProperty: false;\n  /** the general cardinality type of the relationship (aka, hasMany, ownedBy) */\n  relType: ISchemaRelationshipType;\n  /** The constructor for a model of the FK reference that this relationship maintains */\n  fkConstructor: new () => T;\n  fkModelName: string;\n}\nexport interface IModelPropertyMeta<T extends Model = Model>\n  extends IDictionary {\n  /** the property name */\n  property: Extract<keyof T, string>;\n  /** the type of the property */\n  type: string;\n  /** constraint: a maximum length */\n  length?: number;\n  /** constraint: a minimum value */\n  min?: number;\n  /** constraint: a maximum value */\n  max?: number;\n  /** the name -- if it exists -- of the property on the FK which points back to this record */\n  inverse?: string;\n  /** is this prop a FK relationship to another entity/entities */\n  isRelationship: boolean;\n  /** is this prop an attribute of the schema (versus being a relationship) */\n  isProperty?: boolean;\n  /** is this property an array which is added to using firebase pushkeys? */\n  pushKey?: boolean;\n  /** what kind of relationship does this foreign key contain */\n  relType?: ISchemaRelationshipType;\n  /** if the property is a relationship ... a constructor for the FK's Model */\n  fkConstructor?: new () => any;\n  fkModelName?: string;\n}\n\n/** lookup meta data for schema properties */\nfunction getModelProperty<T extends Model = Model>(modelKlass: object) {\n  return (prop: string): IModelPropertyMeta<T> =>\n    Reflect.getMetadata(prop, modelKlass);\n}\n\nfunction getModelRelationship<T extends Model = Model>(\n  relationships: Array<IModelRelationshipMeta<T>>\n) {\n  return (relnProp: string): IModelRelationshipMeta<T> =>\n    relationships.find(i => relnProp === i.property);\n}\n\nexport function model(options: IModelMetaProperties): ClassDecorator {\n  let isDirty: boolean = false;\n  return (target: any): void => {\n    const original = target;\n\n    // new constructor\n    const f: any = function(...args: any[]) {\n      const meta = options;\n      const obj = Reflect.construct(original, args);\n\n      Reflect.defineProperty(obj, \"META\", {\n        get(): IModelMetaProperties {\n          return {\n            ...options,\n            ...{ property: getModelProperty(obj) },\n            ...{ properties: getProperties(obj) },\n            ...{ relationship: getModelRelationship(getRelationships(obj)) },\n            ...{ relationships: getRelationships(obj) },\n            ...{ pushKeys: getPushKeys(obj) },\n            ...{ audit: options.audit ? options.audit : false },\n            ...{ isDirty }\n          };\n        },\n        set(prop: IDictionary) {\n          if (typeof prop === \"object\" && prop.isDirty !== undefined) {\n            isDirty = prop.isDirty;\n          } else {\n            throw new Error(\n              \"The META properties should only be set with the @model decorator at design time!\"\n            );\n          }\n        },\n        configurable: false,\n        enumerable: false\n      });\n      return obj;\n    };\n\n    // copy prototype so intanceof operator still works\n    f.prototype = original.prototype;\n\n    // return new constructor (will override original)\n    return f;\n  };\n}\n","// tslint:disable:no-unused-expression\nexport type NonProperties<T> = {\n  [P in keyof T]: T[P] extends () => any ? never : P\n}[keyof T];\nexport type Properties<T> = Pick<T, NonProperties<T>>;\nimport { IDictionary, epochWithMilliseconds, datetime } from \"common-types\";\nimport { property, mock } from \"./decorators/property\";\nimport { IModelMetaProperties } from \"./decorators/schema\";\n\nexport interface IModelOptions {\n  logger?: ILogger;\n  db?: import(\"abstracted-firebase\").RealTimeDB;\n}\nexport interface IMetaData {\n  attributes: IDictionary;\n  relationships: IDictionary<IRelationship>;\n}\n\nexport interface IAuditFilter {\n  /** audit entries since a given unix epoch timestamp */\n  since?: number;\n  /** the last X number of audit entries */\n  last?: number;\n}\n\nexport type IComparisonOperator = \"=\" | \">\" | \"<\";\nexport type IConditionAndValue = [\n  IComparisonOperator,\n  boolean | string | number\n];\nexport type FirebaseCrudOperations = \"push\" | \"set\" | \"update\" | \"remove\";\n\nexport interface IAuditRecord {\n  crud: FirebaseCrudOperations;\n  when: datetime;\n  schema: string;\n  key: string;\n  info: IDictionary;\n}\n\nexport interface ILogger {\n  log: (message: string) => void;\n  warn: (message: string) => void;\n  debug: (message: string) => void;\n  error: (message: string) => void;\n}\n\nexport interface IRelationship {\n  cardinality: string;\n  policy: RelationshipPolicy;\n}\nexport enum RelationshipPolicy {\n  keys = \"keys\",\n  lazy = \"lazy\",\n  inline = \"inline\"\n}\nexport enum RelationshipCardinality {\n  hasMany = \"hasMany\",\n  belongsTo = \"belongsTo\"\n}\n\nexport type FMModelConstructor<T> = new () => T;\n\nexport abstract class Model {\n  /** The primary-key for the record */\n  @property public id?: string;\n  /** The last time that a given record was updated */\n  @property\n  @mock(\"dateRecentMiliseconds\")\n  public lastUpdated?: epochWithMilliseconds;\n  /** The datetime at which this record was first created */\n  @property\n  @mock(\"datePastMiliseconds\")\n  public createdAt?: epochWithMilliseconds;\n  /** Metadata properties of the given schema */\n  public META?: IModelMetaProperties;\n}\n","import { Model, IModelOptions } from \"./Model\";\nimport { Record } from \"./Record\";\nimport { SerializedQuery, IComparisonOperator } from \"serialized-query\";\n\nimport { epochWithMilliseconds } from \"common-types\";\nimport { FireModel } from \"./FireModel\";\n// tslint:disable-next-line:no-implicit-dependencies\nimport { RealTimeDB } from \"abstracted-firebase\";\nimport { IReduxDispatch } from \"./VuexWrapper\";\n\nconst DEFAULT_IF_NOT_FOUND = \"__DO_NOT_USE__\";\n\nexport class List<T extends Model> extends FireModel<T> {\n  //#region STATIC Interfaces\n\n  public static set defaultDb(db: RealTimeDB) {\n    FireModel.defaultDb = db;\n  }\n  public static get defaultDb() {\n    return FireModel.defaultDb;\n  }\n\n  public static set dispatch(fn: IReduxDispatch) {\n    FireModel.dispatch = fn;\n  }\n\n  public static create<T extends Model>(\n    model: new () => T,\n    options: IModelOptions = {}\n  ) {\n    return new List<T>(model);\n  }\n\n  /**\n   * Creates a List<T> which is populated with the passed in query\n   *\n   * @param schema the schema type\n   * @param query the serialized query; note that this LIST will override the path of the query\n   * @param options model options\n   */\n  public static async fromQuery<T extends Model>(\n    model: new () => T,\n    query: SerializedQuery,\n    options: IModelOptions = {}\n  ): Promise<List<T>> {\n    const list = List.create(model, options);\n    query.setPath(list.dbPath);\n\n    await list.load(query);\n    return list;\n  }\n\n  /**\n   * Loads all the records of a given schema-type ordered by lastUpdated\n   *\n   * @param schema the schema type\n   * @param options model options\n   */\n  public static async all<T extends Model>(\n    model: new () => T,\n    options: IModelOptions = {}\n  ): Promise<List<T>> {\n    const query = new SerializedQuery().orderByChild(\"lastUpdated\");\n    const list = await List.fromQuery<T>(model, query, options);\n\n    return list;\n  }\n\n  /**\n   * Loads the first X records of the Schema type where\n   * ordering is provided by the \"createdAt\" property\n   *\n   * @param model the model type\n   * @param howMany the number of records to bring back\n   * @param options model options\n   */\n  public static async first<T extends Model>(\n    model: new () => T,\n    howMany: number,\n    options: IModelOptions = {}\n  ): Promise<List<T>> {\n    const query = new SerializedQuery()\n      .orderByChild(\"createdAt\")\n      .limitToLast(howMany);\n    const list = await List.fromQuery(model, query, options);\n\n    return list;\n  }\n\n  /**\n   * recent\n   *\n   * Get recent items of a given type/schema (based on lastUpdated)\n   *\n   * @param model the TYPE you are interested\n   * @param howMany the quantity to of records to bring back\n   * @param offset start at an offset position (useful for paging)\n   * @param options\n   */\n  public static async recent<T extends Model>(\n    model: new () => T,\n    howMany: number,\n    offset: number = 0,\n    options: IModelOptions = {}\n  ): Promise<List<T>> {\n    const query = new SerializedQuery()\n      .orderByChild(\"lastUpdated\")\n      .limitToFirst(howMany);\n    const list = await List.fromQuery(model, query, options);\n\n    return list;\n  }\n\n  /**\n   * since\n   *\n   * Bring back all records that have changed since a given date\n   *\n   * @param schema the TYPE you are interested\n   * @param since  the datetime in miliseconds\n   * @param options\n   */\n  public static async since<T extends Model>(\n    model: new () => T,\n    since: epochWithMilliseconds,\n    options: IModelOptions = {}\n  ): Promise<List<T>> {\n    if (typeof since !== \"number\") {\n      const e = new Error(\n        `Invalid \"since\" parameter; value must be number instead got a(n) ${typeof since} [ ${since} ]`\n      );\n      e.name = \"NotAllowed\";\n      throw e;\n    }\n\n    // const query = new SerializedQuery().orderByChild(\"lastUpdated\").startAt(since);\n    const query = new SerializedQuery<T>()\n      .orderByChild(\"lastUpdated\")\n      .startAt(since);\n    const list = await List.fromQuery(model, query, options);\n\n    return list;\n  }\n\n  public static async inactive<T extends Model>(\n    model: new () => T,\n    howMany: number,\n    options: IModelOptions = {}\n  ): Promise<List<T>> {\n    const query = new SerializedQuery()\n      .orderByChild(\"lastUpdated\")\n      .limitToLast(howMany);\n    const list = await List.fromQuery(model, query, options);\n\n    return list;\n  }\n\n  public static async last<T extends Model>(\n    model: new () => T,\n    howMany: number,\n    options: IModelOptions = {}\n  ): Promise<List<T>> {\n    const query = new SerializedQuery()\n      .orderByChild(\"createdAt\")\n      .limitToFirst(howMany);\n    const list = await List.fromQuery(model, query, options);\n\n    return list;\n  }\n\n  public static async where<T extends Model, K extends keyof T>(\n    model: new () => T,\n    property: K,\n    value: T[K] | [IComparisonOperator, T[K]],\n    options: IModelOptions = {}\n  ) {\n    let operation: IComparisonOperator = \"=\";\n    let val = value;\n    if (Array.isArray(value)) {\n      val = value[1];\n      operation = value[0];\n    }\n    const query = new SerializedQuery()\n      .orderByChild(property)\n      .where(operation, val);\n    const list = await List.fromQuery(model, query, options);\n\n    return list;\n  }\n\n  //#endregion\n\n  private _data: T[] = [];\n\n  constructor(model: new () => T, options: IModelOptions = {}) {\n    super();\n    this._modelConstructor = model;\n    this._model = new model();\n    if (options.db) {\n      this._db = options.db;\n      if (!FireModel.defaultDb) {\n        FireModel.defaultDb = options.db;\n      }\n    }\n  }\n\n  public get length(): number {\n    return this._data.length;\n  }\n\n  public get dbPath() {\n    return [this.META.dbOffset, this.pluralName].join(\"/\");\n  }\n\n  public get localPath() {\n    return [this.META.localOffset, this.pluralName].join(\"/\");\n  }\n\n  /** Returns another List with data filtered down by passed in filter function */\n  public filter(f: ListFilterFunction<T>) {\n    const list = List.create(this._modelConstructor);\n    list._data = this._data.filter(f);\n    return list;\n  }\n\n  /** Returns another List with data filtered down by passed in filter function */\n  public find(\n    f: ListFilterFunction<T>,\n    defaultIfNotFound = DEFAULT_IF_NOT_FOUND\n  ): Record<T> {\n    const filtered = this._data.filter(f);\n    const r = Record.create(this._modelConstructor);\n    if (filtered.length > 0) {\n      r._initialize(filtered[0]);\n      return r;\n    } else {\n      if (defaultIfNotFound !== DEFAULT_IF_NOT_FOUND) {\n        return defaultIfNotFound as any;\n      } else {\n        const e = new Error(\n          `find(fn) did not find a value in the List [ length: ${\n            this.data.length\n          } ]`\n        );\n        e.name = \"NotFound\";\n        throw e;\n      }\n    }\n  }\n\n  public filterWhere<K extends keyof T>(prop: K, value: T[K]): List<T> {\n    const whereFilter = (item: T) => item[prop] === value;\n    const list = new List(this._modelConstructor);\n    list._data = this.data.filter(whereFilter);\n    return list;\n  }\n\n  /**\n   * findWhere\n   *\n   * returns the first record in the list where the property equals the\n   * specified value. If no value is found then an error is thrown unless\n   * it is stated\n   */\n  public findWhere(\n    prop: keyof T,\n    value: T[typeof prop],\n    defaultIfNotFound = DEFAULT_IF_NOT_FOUND\n  ): Record<T> {\n    const list = this.filterWhere(prop, value);\n\n    if (list.length > 0) {\n      return Record.createWith(this._modelConstructor, list._data[0]);\n    } else {\n      if (defaultIfNotFound !== DEFAULT_IF_NOT_FOUND) {\n        return defaultIfNotFound as any;\n      } else {\n        const e = new Error(\n          `findWhere(${prop}, ${value}) was not found in the List [ length: ${\n            this.data.length\n          } ]`\n        );\n        e.name = \"NotFound\";\n        throw e;\n      }\n    }\n  }\n\n  /**\n   * provides a map over the data structured managed by the List; there will be no mutations to the\n   * data managed by the list\n   */\n  public map<K = any>(f: ListMapFunction<T, K>) {\n    return this.data.map(f);\n  }\n\n  public get data() {\n    return this._data;\n  }\n\n  /**\n   * Returns the Record object with the given ID, errors if not found (name: NotFound)\n   * unless call signature includes \"defaultIfNotFound\"\n   *\n   * @param id the unique ID which is being looked for\n   * @param defaultIfNotFound the default value returned if the ID is not found in the list\n   */\n  public findById(\n    id: string,\n    defaultIfNotFound: any = DEFAULT_IF_NOT_FOUND\n  ): Record<T> {\n    const find = this.filter(f => f.id === id);\n    if (find.length === 0) {\n      if (defaultIfNotFound !== DEFAULT_IF_NOT_FOUND) {\n        return defaultIfNotFound;\n      }\n      const e = new Error(\n        `Could not find \"${id}\" in list of ${this.pluralName}`\n      );\n      e.name = \"NotFound\";\n      throw e;\n    }\n\n    const r = Record.create(this._modelConstructor);\n    r._initialize(find.data[0]);\n    return r;\n  }\n\n  public async removeById(id: string, ignoreOnNotFound: boolean = false) {\n    const rec = this.findById(id, null);\n    if (!rec) {\n      if (!ignoreOnNotFound) {\n        const e = new Error(\n          `Could not remove \"${id}\" in list of ${\n            this.pluralName\n          } as the ID was not found!`\n        );\n        e.name = \"NotFound\";\n        throw e;\n      } else {\n        return;\n      }\n    }\n\n    const removed = await Record.remove(this._modelConstructor, id, rec);\n    this._data = this.filter(f => f.id !== id).data;\n  }\n\n  public async add(payload: T) {\n    const newRecord = await Record.add(this._modelConstructor, payload);\n    this._data.push(newRecord.data);\n    return newRecord;\n  }\n\n  /**\n   * Returns the single instance of an object contained by the List container\n   *\n   * @param id the unique ID which is being looked for\n   * @param defaultIfNotFound the default value returned if the ID is not found in the list\n   */\n  public getData(id: string, defaultIfNotFound: any = \"__DO_NOT_USE__\"): T {\n    const record = this.findById(id, defaultIfNotFound);\n\n    return record === defaultIfNotFound\n      ? defaultIfNotFound\n      : ((record as any).data as T);\n  }\n\n  public async load(pathOrQuery: string | SerializedQuery<T>) {\n    if (!this.db) {\n      const e = new Error(\n        `The attempt to load data into a List requires that the DB property be initialized first!`\n      );\n      e.name = \"NoDatabase\";\n      throw e;\n    }\n    this._data = await this.db.getList<T>(pathOrQuery);\n    return this;\n  }\n}\n\nexport type ListFilterFunction<T> = (fc: T) => boolean;\nexport type ListMapFunction<T, K = any> = (fc: T) => K;\n","import { Model } from \"./Model\";\nimport { IDictionary, pathJoin } from \"common-types\";\n// tslint:disable-next-line:no-implicit-dependencies\nimport { RealTimeDB } from \"abstracted-firebase\";\nimport { Record } from \"./Record\";\nimport { arrayToHash } from \"typed-conversions\";\nimport { IModelPropertyMeta } from \"./decorators/schema\";\nimport { fbKey } from \"./index\";\nimport { set } from \"lodash\";\nimport { MockHelper } from \"firemock\";\n\nexport type ICardinalityConfig<T> = {\n  [key in keyof T]: [number, number] | number | true\n};\n\nexport interface IMockConfig<T> {\n  relationshipBehavior: \"ignore\" | \"link\" | \"follow\";\n  cardinality?: IDictionary<number | [number, number] | true>;\n}\n\nfunction defaultCardinality<T>(r: Record<T>) {\n  return r.META.relationships.reduce(\n    (prev, curr) => {\n      prev = { ...prev, [curr.property]: true };\n    },\n    {} as any\n  );\n}\n\nfunction dbOffset<T extends Model>(record: Record<T>, payload: IDictionary<T>) {\n  const output = {};\n  const path = pathJoin(record.META.dbOffset || \"\", record.pluralName);\n\n  set(output, path.replace(/\\//g, \".\"), payload);\n  return output;\n}\n\nfunction fakeIt(helper: MockHelper, type: string) {\n  switch (type) {\n    case \"id\":\n      return fbKey();\n    case \"String\":\n      return helper.faker.lorem.words(5);\n    case \"Number\":\n      return Math.round(Math.random() * 100);\n    case \"Boolean\":\n      return Math.random() > 0.49 ? true : false;\n    case \"Object\":\n      return {};\n    case \"name\":\n      return helper.faker.name.firstName() + \" \" + helper.faker.name.lastName();\n    case \"firstName\":\n      return helper.faker.name.firstName();\n    case \"lastName\":\n      return helper.faker.name.lastName();\n    case \"company\":\n      return helper.faker.company.companyName();\n    case \"address\":\n      return (\n        helper.faker.address.secondaryAddress() +\n        \", \" +\n        helper.faker.address.city() +\n        \", \" +\n        helper.faker.address.stateAbbr() +\n        \"  \" +\n        helper.faker.address.zipCode()\n      );\n    case \"streetName\":\n      return helper.faker.address.streetName();\n    case \"streetAddress\":\n      return helper.faker.address.streetAddress();\n    case \"city\":\n      return helper.faker.address.city();\n    case \"state\":\n      return helper.faker.address.state();\n    case \"stateAbbr\":\n      return helper.faker.address.stateAbbr();\n    case \"country\":\n      return helper.faker.address.country();\n    case \"countryCode\":\n      return helper.faker.address.countryCode();\n    case \"latitude\":\n      return helper.faker.address.latitude();\n    case \"longitude\":\n      return helper.faker.address.longitude();\n    case \"gender\":\n      return helper.faker.helpers.shuffle([\"male\", \"female\", \"other\"]);\n    case \"date\":\n    case \"dateRecent\":\n      return helper.faker.date.recent();\n    case \"dateMiliseconds\":\n    case \"dateRecentMiliseconds\":\n      return helper.faker.date.recent().getTime();\n    case \"datePast\":\n      return helper.faker.date.past();\n    case \"datePastMiliseconds\":\n      return helper.faker.date.past().getTime();\n    case \"dateFuture\":\n      return helper.faker.date.future();\n    case \"dateFutureMiliseconds\":\n      return helper.faker.date.future().getTime();\n    case \"dateSoon\":\n      return helper.faker.date.soon();\n    case \"dateSoonMiliseconds\":\n      return helper.faker.date.soon().getTime();\n    case \"image\":\n    case \"avatar\":\n      return helper.faker.image.avatar();\n    case \"imageAnimal\":\n      return helper.faker.image.animals();\n    case \"imagePeople\":\n      return helper.faker.image.people();\n    case \"imageNature\":\n      return helper.faker.image.nature();\n    case \"imageTransport\":\n      return helper.faker.image.transport();\n    case \"phoneNumber\":\n      return helper.faker.phone.phoneNumber();\n    default:\n      return helper.faker.lorem.slug();\n  }\n}\n\nfunction mockValue<T extends Model>(\n  db: RealTimeDB,\n  propMeta: IModelPropertyMeta<T>\n) {\n  if (!db || !(db instanceof RealTimeDB)) {\n    const e = new Error(\n      `When trying to Mock the value of \"${\n        propMeta.property\n      }\" the database reference passed in not a valid instance of the RealTimeDB provided by either 'abstracted-client' or 'abstracted-server' [ ${typeof db} ].`\n    );\n    e.name = \"FireModel::NotReady\";\n    throw e;\n  }\n  const helper = db.mock.getMockHelper();\n  const { type, mockType } = propMeta;\n\n  if (mockType) {\n    return typeof mockType === \"function\"\n      ? mockType(helper)\n      : fakeIt(helper, mockType);\n  } else {\n    const namePatterns: IDictionary<string> = {\n      id: \"id\",\n      name: \"name\",\n      fullname: \"name\",\n      firstName: \"firstName\",\n      lastName: \"lastName\",\n      address: \"address\",\n      city: \"city\",\n      state: \"stateAbbr\",\n      country: \"countryCode\",\n      street: \"streetAddress\",\n      streetAddress: \"streetAddress\",\n      lat: \"latitude\",\n      latitude: \"latitude\",\n      lon: \"longitude\",\n      longitude: \"longitude\",\n      avatar: \"avatar\",\n      phone: \"phoneNumber\",\n      phoneNumber: \"phoneNumber\"\n    };\n    return fakeIt(\n      helper,\n      Object.keys(namePatterns).includes(propMeta.property)\n        ? namePatterns[propMeta.property]\n        : type\n    );\n  }\n}\n\nfunction properties<T extends Model>(\n  db: RealTimeDB,\n  config: IMockConfig<T>,\n  exceptions: IDictionary\n) {\n  return (instance: T): T => {\n    if (!instance.META) {\n      const e = new Error(\n        `The instance passed passed into properties does not have any META properties! [ ${typeof instance} ]`\n      );\n      e.name = \"FireModel::MockError\";\n      throw e;\n    }\n\n    const props = instance.META.properties;\n    props.map(prop => {\n      (instance as any)[prop.property] = mockValue<T>(db, prop);\n    });\n    return instance;\n  };\n}\n\nfunction NumberBetween(startEnd: [number, number]) {\n  return (\n    Math.floor(Math.random() * (startEnd[1] - startEnd[0] + 1)) + startEnd[0]\n  );\n}\n\nfunction addRelationships<T extends Model>(\n  db: RealTimeDB,\n  config: IMockConfig<T>,\n  exceptions: IDictionary\n) {\n  return (instance: T): T => {\n    const relns = instance.META.relationships;\n    if (!relns || config.relationshipBehavior === \"ignore\") {\n      return instance;\n    }\n    relns.map(rel => {\n      if (\n        !config.cardinality ||\n        Object.keys(config.cardinality).includes(rel.property)\n      ) {\n        if (rel.relType === \"ownedBy\") {\n          (instance as any)[rel.property] = fbKey();\n        } else {\n          const cardinality = config.cardinality\n            ? typeof config.cardinality[rel.property] === \"number\"\n              ? config.cardinality[rel.property]\n              : NumberBetween(config.cardinality[rel.property] as any)\n            : 2;\n\n          (instance as any)[rel.property] = [];\n          for (let i = 0; i < cardinality; i++) {\n            (instance as any)[rel.property].push(fbKey());\n          }\n        }\n      }\n    });\n    return instance;\n  };\n}\n\nfunction followRelationships<T extends Model>(\n  db: RealTimeDB,\n  config: IMockConfig<T>,\n  exceptions: IDictionary\n) {\n  return (instance: T): T => {\n    const relns = instance.META.relationships;\n    if (!relns || config.relationshipBehavior !== \"follow\") {\n      return instance;\n    }\n\n    instance = addRelationships(db, config, exceptions)(instance);\n\n    relns.map(rel => {\n      const fkConstructor = rel.fkConstructor;\n      let foreignModel = new fkConstructor();\n\n      const fks = getRelationshipIds<T>(instance, rel as any);\n      fks.map(fk => {\n        foreignModel = properties(db, { relationshipBehavior: \"link\" }, {})(\n          foreignModel\n        );\n        foreignModel.id = fk;\n        if (rel.inverse) {\n          const inverseType = foreignModel.META.property(rel.inverse).relType;\n          if (inverseType === \"hasMany\") {\n            // TODO: look at after implementing relationship mgmt\n          }\n        }\n\n        Record.add(fkConstructor, foreignModel);\n      });\n    });\n\n    return instance;\n  };\n}\n\nfunction getRelationshipIds<T>(\n  instance: T,\n  rel: IModelPropertyMeta<T>\n): string[] {\n  if (rel.relType === \"ownedBy\") {\n    return [instance[rel.property]] as any;\n  } else {\n    return instance[rel.property] as any;\n  }\n}\n\nexport function Mock<T extends Model>(\n  modelConstructor: new () => T,\n  db: RealTimeDB\n) {\n  const record: Record<T> = Record.create(modelConstructor);\n  const config: IMockConfig<T> = { relationshipBehavior: \"ignore\" };\n\n  const API = {\n    /**\n     * generate\n     *\n     * Populates the mock database with values for a given model passed in.\n     *\n     * @param count how many instances of the given Model do you want?\n     * @param exceptions do you want to fix a given set of properties to a static value?\n     */\n    generate(count: number, exceptions?: IDictionary) {\n      const props = properties<T>(db, config, exceptions);\n      const relns = addRelationships<T>(db, config, exceptions);\n      const follow = followRelationships<T>(db, config, exceptions);\n      const records: T[] = [];\n      for (let i = 0; i < count; i++) {\n        const model = new modelConstructor();\n        records.push(follow(relns(props(model))));\n      }\n\n      db.mock.updateDB(dbOffset(record, arrayToHash(records)));\n    },\n    /**\n     * createRelationshipLinks\n     *\n     * Creates FK links for all the relationships in the model you are generating.\n     *\n     * @param cardinality an optional param which allows you to have fine grained control over how many of each type of relationship should be added\n     */\n    createRelationshipLinks(\n      cardinality?: IDictionary<[number, number] | number | true>\n    ) {\n      config.relationshipBehavior = \"link\";\n      return API;\n    },\n    /**\n     * followRelationshipLinks\n     *\n     * Creates FK links for all the relationships in the model you are generating; also generates\n     * mocks for all the FK links.\n     *\n     * @param cardinality an optional param which allows you to have fine grained control over how many of each type of relationship should be added\n     */\n    followRelationshipLinks(\n      cardinality?: IDictionary<[number, number] | number | true>\n    ) {\n      // TODO: would like to move back to ICardinalityConfig<T> when I can figure out why Partial doesn't work\n      config.relationshipBehavior = \"follow\";\n      if (cardinality) {\n        config.cardinality = cardinality;\n      }\n      return API;\n    }\n  };\n  return API;\n}\n"],"names":["get","set","createError","fbKey","pathJoin","RelationshipPolicy","RelationshipCardinality","tslib_1.__decorate","SerializedQuery","RealTimeDB","model","arrayToHash"],"mappings":"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"}